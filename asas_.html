<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>eRaport</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f0f2f5;
  padding: 20px;
}

.box {
  max-width: 400px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

input, select {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 16px;
}

button {
  width: 100%;
  padding: 12px;
  background: #1a73e8;
  color: white;
  border: none;
  margin-top: 15px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
}

button:hover {
  background: #0c58c5;
}

#error {
  color: red;
  margin-top: 10px;
  text-align: center;
}

#dashboardBox {
  display: none;
}

/* ======================= NILAI ======================= */
#nilaiContainer {
  position: relative;
  margin: auto;
  width: 200px;
  height: 200px;
}

#nilai {
  font-size: 70px;
  font-weight: bold;
  text-align: center;
  padding-top: 55px;
  transition: 0.4s;
}

.green { color: green; }
.red { color: red; }

/* ======================= FLOATING STIKER ======================= */
#stikerTutup {
  position: absolute;
  width: 180px;
  height: 180px;
  top: 10px;
  left: 10px;
  border-radius: 50%;
  background-size: cover !important;
  cursor: pointer;
  transition: transform .3s ease;
}

#stikerTutup:hover {
  transform: scale(1.08);
}

</style>
</head>

<body>

<!-- ======================= LOGIN BOX ======================= -->
<div class="box" id="loginBox">
  <h2 style="text-align:center;">Login eRaport</h2>

  <input id="username" placeholder="Masukkan NISN">
  <input id="password" type="password" placeholder="Password eRapor">

  <select id="kelas">
    <option value="KELAS7">KELAS 7</option>
    <option value="KELAS8">KELAS 8</option>
    <option value="KELAS9">KELAS 9</option>
  </select>

  <button onclick="login()">MASUK</button>

  <div id="error"></div>
</div>


<!-- ======================= DASHBOARD BOX ======================= -->
<div class="box" id="dashboardBox">
  <h2 style="text-align:center;">Hasil Nilai</h2>

  <p><b>Nama:</b> <span id="nama"></span></p>
  <p><b>Kelas:</b> <span id="kelasOut"></span></p>

  <div id="nilaiContainer">
    <div id="nilai"></div>

    <!-- floating stiker otomatis -->
    <div id="stikerTutup" onclick="toggleNilai()"></div>
  </div>

  <p><b>Motivasi:</b> <span id="motivasi"></span></p>
  <p><b>Catatan Remidi:</b> <span id="remidi"></span></p>

</div>


<script>
// ======================= KONFIGURASI =======================
const SHEET_ID = "10TG5AWYG9NaP1XvZIbP26r4dVyfAz20u";   // â† ganti dengan ID kamu
const PASSWORD_GLOBAL = "asas2025";


// ======================= Fungsi Proper Case =======================
function toProper(text) {
  return text.replace(/\w\S*/g, 
    t => t.charAt(0).toUpperCase() + t.substr(1).toLowerCase());
}


// ======================= PILIH STIKER OTOMATIS =======================
function pilihStiker(nilai) {
  if (nilai < 40) return "9.jpg";
  if (nilai < 50) return "8.jpg";
  if (nilai < 60) return "1.jpg";
  if (nilai < 70) return "2.jpg";
  if (nilai < 78) return "3.jpg";
  if (nilai < 80) return "6.jpg";
  if (nilai < 85) return "5.jpg";
  if (nilai < 90) return "10.jpg";
  if (nilai < 95) return "4.jpg";
  if (nilai < 100) return "11.jpg";
  return "11.jpg";
}


// ======================= LOGIN =======================
async function login() {
  const nisn = username.value.trim();
  const pass = password.value.trim();
  const kelas = document.getElementById("kelas").value;
  const err = document.getElementById("error");

  if (pass !== PASSWORD_GLOBAL) {
    err.innerText = "Password salah!";
    return;
  }

  err.innerText = "";

  const url = `https://docs.google.com/spreadsheets/d/${10TG5AWYG9NaP1XvZIbP26r4dVyfAz20u}/gviz/tq?sheet=${kelas}&tqx=out:json`;

  try {
    const res = await fetch(url);
    const raw = await res.text();
    const json = JSON.parse(raw.substring(47, raw.length - 2));

    const rows = json.table.rows.map(r => r.c.map(c => (c ? c.v : "")));

    const siswa = rows.find(r => String(r[0]) === nisn);

    if (!siswa) {
      err.innerText = "NISN tidak ditemukan!";
      return;
    }

    // tampilkan dashboard
    loginBox.style.display = "none";
    dashboardBox.style.display = "block";

    nama.innerText = toProper(siswa[1]);
    kelasOut.innerText = siswa[2];

    const nilai = Number(siswa[4]);
    const kkm = Number(siswa[5]);

    nilaiEl = document.getElementById("nilai");
    nilaiEl.innerText = nilai;

    nilaiEl.classList.remove("red", "green");
    nilaiEl.classList.add(nilai < kkm ? "red" : "green");

    motivasi.innerText = siswa[6];
    remidi.innerText = siswa[8];

    // blur nilai dulu
    nilaiEl.style.filter = "blur(20px)";

    // pilih stiker
    const img = pilihStiker(nilai);
    const stikerEl = document.getElementById("stikerTutup");
    stikerEl.style.background = `url('assets/${img}') center/cover`;
    stikerEl.style.display = "block";

  } catch (e) {
    err.innerText = "Gagal mengambil data!";
  }
}


// ======================= SHOW / HIDE NILAI =======================
let nilaiTerbuka = false;

function toggleNilai() {
  nilaiTerbuka = !nilaiTerbuka;

  const stiker = document.getElementById("stikerTutup");
  const nilai = document.getElementById("nilai");

  if (nilaiTerbuka) {
    stiker.style.display = "none";
    nilai.style.filter = "blur(0px)";
  } else {
    stiker.style.display = "block";
    nilai.style.filter = "blur(20px)";
  }
}

</script>

</body>
</html>
